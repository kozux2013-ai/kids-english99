<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å…’ç«¥è‹±æ–‡å­¸ç¿’</title>

<style>
body {
  font-family: system-ui;
  background: linear-gradient(#fff1c1, #ffd89c);
  text-align: center;
  padding: 20px;
}
.card {
  background: white;
  border-radius: 25px;
  padding: 25px;
  max-width: 420px;
  margin: auto;
}
button {
  font-size: 1.1em;
  padding: 10px 18px;
  margin: 6px;
  border-radius: 15px;
  border: none;
  background: #ff9800;
  color: white;
}
input, textarea {
  font-size: 1.1em;
  padding: 8px;
  width: 85%;
  border-radius: 10px;
  border: 1px solid #ccc;
}
img {
  width: 150px;
  margin: 10px;
}
.mode {
  margin-top: 10px;
}
.star {
  font-size: 1.4em;
}
.hidden {
  display: none;
}
</style>
</head>

<body>

<div class="card">

  <div class="star">â­ æ˜Ÿæ˜Ÿï¼š<span id="stars">0</span></div>

  <!-- æ¨¡å¼åˆ‡æ› -->
  <div class="mode">
    <button onclick="setMode('learn')">ğŸ’ å­¸ç¿’</button>
    <button onclick="setMode('parent')">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ å®¶é•·</button>
    <button onclick="setMode('record')">ğŸ“Š ç´€éŒ„</button>
  </div>

  <!-- å­¸ç¿’æ¨¡å¼ -->
  <div id="learn">
    <h2>ä¸­æ–‡æç¤º</h2>
    <h1 id="zh">è˜‹æœ</h1>
    <img id="pic" src="">
    <br>
    <input id="answer" placeholder="è¼¸å…¥è‹±æ–‡">
    <br>
    <button onclick="check()">æª¢æŸ¥ç­”æ¡ˆ</button>
    <br>
    <button onclick="speak()">ğŸ”Š è½ç™¼éŸ³</button>
    <button onclick="listen()">ğŸ¤ æˆ‘ä¾†å”¸</button>
    <p id="msg"></p>
  </div>

  <!-- å®¶é•·æ¨¡å¼ -->
  <div id="parent" class="hidden">
    <h3>å®¶é•·è¼¸å…¥å–®å­—</h3>
    <p>æ ¼å¼ï¼šè‹±æ–‡ ä¸­æ–‡ï¼ˆä¸€è¡Œä¸€å€‹ï¼‰</p>
    <textarea id="parentInput" rows="5"></textarea><br>
    <button onclick="saveWords()">å„²å­˜</button>
    <p id="parentMsg"></p>
  </div>

  <!-- ç´€éŒ„ -->
  <div id="record" class="hidden">
    <h3>å­¸ç¿’ç´€éŒ„</h3>
    <p>ç›®å‰æ˜Ÿæ˜Ÿ â­ï¼š<span id="recordStars"></span></p>
  </div>

</div>

<script>
let words = JSON.parse(localStorage.getItem("words")) || [
  { en: "apple", zh: "è˜‹æœ", img: "https://via.placeholder.com/150?text=Apple" },
  { en: "cat", zh: "è²“", img: "https://via.placeholder.com/150?text=Cat" },
  { en: "dog", zh: "ç‹—", img: "https://via.placeholder.com/150?text=Dog" }
];

let stars = Number(localStorage.getItem("stars")) || 0;
let current = {};

document.getElementById("stars").innerText = stars;

function setMode(m) {
  ["learn","parent","record"].forEach(id=>{
    document.getElementById(id).classList.add("hidden");
  });
  document.getElementById(m).classList.remove("hidden");

  if (m === "record") {
    document.getElementById("recordStars").innerText = stars;
  }
}

function next() {
  current = words[Math.floor(Math.random() * words.length)];
  document.getElementById("zh").innerText = current.zh;
  document.getElementById("pic").src = current.img;
  document.getElementById("answer").value = "";
  document.getElementById("msg").innerText = "";
}

function check() {
  const a = document.getElementById("answer").value.toLowerCase();
  if (a === current.en) {
    stars++;
    localStorage.setItem("stars", stars);
    document.getElementById("stars").innerText = stars;
    document.getElementById("msg").innerText = "ğŸ‰ å¥½æ£’ï¼";
    setTimeout(next, 800);
  } else {
    document.getElementById("msg").innerText = "ğŸ˜Š å†è©¦ä¸€æ¬¡";
  }
}

function speak() {
  const u = new SpeechSynthesisUtterance(current.en);
  u.lang = "en-US";
  speechSynthesis.speak(u);
}

function listen() {
  const R = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!R) return alert("ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜");
  const r = new R();
  r.lang = "en-US";
  r.onresult = e => {
    if (e.results[0][0].transcript.toLowerCase().includes(current.en)) {
      stars++;
      localStorage.setItem("stars", stars);
      document.getElementById("stars").innerText = stars;
      document.getElementById("msg").innerText = "ğŸŒŸ ç™¼éŸ³å¾ˆæ£’ï¼";
      setTimeout(next, 800);
    }
  };
  r.start();
}

function saveWords() {
  const lines = document.getElementById("parentInput").value.split("\n");
  lines.forEach(l=>{
    const [en, zh] = l.split(" ");
    if (en && zh) {
      words.push({
        en,
        zh,
        img: https://via.placeholder.com/150?text=${en}
      });
    }
  });
  localStorage.setItem("words", JSON.stringify(words));
  document.getElementById("parentMsg").innerText = "âœ… å·²å„²å­˜";
}

next();
</script>
</body>
</html>
